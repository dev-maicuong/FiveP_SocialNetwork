@using FivePSocialNetwork.Models;
@{
    FivePSocialNetWorkEntities db = new FivePSocialNetWorkEntities();
    User user;
}
<nav class="navbar navbar-top navbar-expand navbar-dark border-bottom sticky-top" style="background-color:orange">
    <div class="container-fluid">
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <!-- Search form -->
            <form action="@Url.Action("Search","Center")" method="get" class="navbar-search navbar-search-light form-inline mr-sm-3" id="navbar-search-main">
                <div class="form-group mb-0">
                    <div class="input-group input-group-alternative input-group-merge">
                        <div class="input-group-prepend">
                            <span class="input-group-text"><i class="fas fa-search"></i></span>
                        </div>
                        <input class="form-control" name="search" placeholder="Bạn cần tìm gì ...?" type="text">
                    </div>
                </div>
                @*<div class="">
                        <a href="@Url.Action("PostQuestion","Question")" class="btn btn-sm btn-neutral"><i class="far fa-paper-plane"></i> Đặt câu hỏi?</a>
                        <a href="#" class="btn btn-sm btn-neutral"><i class="far fa-edit"></i> Đăng bài viết </a>
                    </div>*@
                <button type="button" class="close" data-action="search-close" data-target="#navbar-search-main" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </form>
            <!-- Navbar links -->
            @if (Request.Cookies["user_id"] != null)
            {
                int user_id = int.Parse(Request.Cookies["user_id"].Value.ToString());
                user = db.Users.Find(user_id);
                <ul class="navbar-nav align-items-center  ml-md-auto ">
                    <li class="nav-item d-xl-none">
                        <!-- Sidenav toggler -->
                        <div class="pr-3 sidenav-toggler sidenav-toggler-dark" data-action="sidenav-pin" data-target="#sidenav-main">
                            <div class="sidenav-toggler-inner">
                                <i class="sidenav-toggler-line"></i>
                                <i class="sidenav-toggler-line"></i>
                                <i class="sidenav-toggler-line"></i>
                            </div>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        @{
                            List<Message> messagesCount = db.Messages.Where(n => n.messageRecipients_id == user_id && n.message_status == false && n.message_recycleBin == false).ToList();
                            List<Message> messages = db.Messages.Where(n => n.messageRecipients_id == user_id && n.message_recycleBin == false).OrderByDescending(n => n.message_dateSend).Take(6).ToList();
                        }
                        <a class="nav-link" href="#" id="messageNotification" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="ni ni-chat-round" id="messageCount">@messagesCount.Count()</i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-xl  dropdown-menu-right  py-0 overflow-hidden">
                            <!-- Dropdown header -->

                            <div class="px-3 py-3">
                                <h6 class="text-sm text-muted m-0">Có <strong class="text-primary">@messagesCount.Count()</strong> tin nhắn đến.</h6>
                            </div>
                            <!-- List group -->
                            <div class="list-group list-group-flush">
                                @foreach (var item in messages)
                                {
                                    <a href="@Url.Action("Index","Message",new { id = item.messageSender_id})" class="list-group-item list-group-item-action">
                                        <div class="row align-items-center">
                                            <div class="col-auto">
                                                <!-- Avatar -->
                                                <img alt="Image placeholder" src="~/Image/Users/@item.User.user_avatar" class="avatar rounded-circle">
                                            </div>
                                            <div class="col ml--2">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <h4 class="mb-0 text-sm">@item.User.user_firstName @item.User.user_lastName</h4>
                                                    </div>
                                                    <div class="text-right text-muted">
                                                        <small>@item.message_dateSend</small>
                                                    </div>
                                                </div>
                                                <p class="text-sm mb-0">
                                                    @if (item.message_content != null && item.message_content.Length > 25)
                                                    {
                                                        @item.message_content.Substring(0, 25)
                                                    }
                                                    else if (item.message_content != null)
                                                    {
                                                        @item.message_content
                                                    }
                                                </p>
                                            </div>
                                        </div>
                                    </a>
                                }
                            </div>
                            <!-- View all -->
                            <span class="dropdown-item text-center text-primary font-weight-bold py-3"><i class="fab fa-facebook-messenger"></i>Tin nhắn</span>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        @{ 
                            List<Notification> notificationsCount = db.Notifications.Where(n => n.notification_status == false && n.notification_recycleBin == false && n.receiver_id == user_id).ToList();
                            List<Notification> notifications = db.Notifications.Where(n => n.notification_recycleBin == false && n.receiver_id == user_id).OrderByDescending(n => n.notification_dateCreate).Take(6).ToList();
                        }
                        <a class="nav-link" href="#" id="notification" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="ni ni-bell-55" id="notificationCount">@notificationsCount.Count()</i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-xl  dropdown-menu-right  py-0 overflow-hidden">
                            <!-- Dropdown header -->
                            <div class="px-3 py-3">
                                <h6 class="text-sm text-muted m-0">Bạn có <strong class="text-primary">@notificationsCount.Count()</strong> thông báo.</h6>
                            </div>
                            <!-- List group -->
                            <div class="list-group list-group-flush">
                                @foreach (var item in notifications)
                                {
                                    <a href="@Url.Action("DetailQuestion","FunctionAtDetailQuestion",new {id = item.question_id})" class="list-group-item list-group-item-action">
                                        <div class="row align-items-center">
                                            <div class="col-auto">
                                                <!-- Avatar -->
                                                <img alt="Image placeholder" src="~/Image/Users/@item.User1.user_avatar" class="avatar rounded-circle">
                                            </div>
                                            <div class="col ml--2">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <h4 class="mb-0 text-sm">@item.User1.user_firstName  @item.User1.user_lastName</h4>
                                                    </div>
                                                    <div class="text-right text-muted">
                                                        <small>@item.notification_dateCreate</small>
                                                    </div>
                                                </div>
                                                <p class="text-sm mb-0">@item.notification_content</p>
                                            </div>
                                        </div>
                                    </a>

                                }


                            </div>
                            <!-- View all -->
                            <a href="@Url.Action("ManagementNotification","UserManagement")" class="dropdown-item text-center text-primary font-weight-bold py-3"><i class="ni ni-bell-55"></i>Tất cả thông báo</a>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="ni ni-ungroup"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-dark bg-default  dropdown-menu-right ">
                            <div class="row shortcuts px-4">
                                <a href="#!" class="col-4 shortcut-item">
                                    <span class="shortcut-media avatar rounded-circle bg-gradient-red">
                                        <i class="ni ni-calendar-grid-58"></i>
                                    </span>
                                    <small>Calendar</small>
                                </a>
                                <a href="#!" class="col-4 shortcut-item">
                                    <span class="shortcut-media avatar rounded-circle bg-gradient-orange">
                                        <i class="ni ni-email-83"></i>
                                    </span>
                                    <small>Tiếng Việt</small>
                                </a>
                                <a href="#!" class="col-4 shortcut-item">
                                    <span class="shortcut-media avatar rounded-circle bg-gradient-info">
                                        <i class="ni ni-credit-card"></i>
                                    </span>
                                    <small>Tiếng Anh</small>
                                </a>
                                <a href="#!" class="col-4 shortcut-item">
                                    <span class="shortcut-media avatar rounded-circle bg-gradient-green">
                                        <i class="ni ni-books"></i>
                                    </span>
                                    <small>Reports</small>
                                </a>
                                <a href="#!" class="col-4 shortcut-item">
                                    <span class="shortcut-media avatar rounded-circle bg-gradient-purple">
                                        <i class="ni ni-pin-3"></i>
                                    </span>
                                    <small>Maps</small>
                                </a>
                                <a href="#!" class="col-4 shortcut-item">
                                    <span class="shortcut-media avatar rounded-circle bg-gradient-yellow">
                                        <i class="ni ni-basket"></i>
                                    </span>
                                    <small>Shop</small>
                                </a>
                            </div>
                        </div>
                    </li>
                </ul>
                <ul class="navbar-nav align-items-center  ml-auto ml-md-0 ">
                    <li class="nav-item dropdown">
                        <a class="nav-link pr-0" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <div class="media align-items-center">
                                <span class="avatar avatar-sm rounded-circle">
                                    <img alt="Image placeholder" src="~/Image/Users/@user.user_avatar">
                                </span>
                                <div class="media-body  ml-2  d-none d-lg-block">
                                    <span class="mb-0 text-sm  font-weight-bold">@user.user_firstName @user.user_lastName</span>
                                </div>
                            </div>
                        </a>
                        <div class="dropdown-menu  dropdown-menu-right ">
                            <div class="dropdown-header noti-title">
                                <h6 class="text-overflow m-0">
                                    Mã của bạn : @user.user_code
                                </h6>
                            </div>
                            <a href="@Url.Action("PageUser","UserManagement")" class="dropdown-item">
                                <i class="ni ni-single-02"></i>
                                <span>Cá nhân</span>
                            </a>
                            <a href="@Url.Action("SettingAccount","Account")" class="dropdown-item">
                                <i class="ni ni-settings-gear-65"></i>
                                <span>Cài đặt cá nhân</span>
                            </a>
                            <a href="@Url.Action("Security","Account")" class="dropdown-item">
                                <i class="fas fa-shield-alt"></i>
                                <span>Bảo mật và đăng nhập</span>
                            </a>
                            <a href="@Url.Action("HistoryDeleteQuestion","UserManagement")" class="dropdown-item">
                                <i class="fas fa-history"></i>
                                <span class="nav-link-text">Lịch sử xóa câu hỏi</span>
                            </a>
                            <a href="@Url.Action("HistoryDeleteAnswer","UserManagement")" class="dropdown-item">
                                <i class="fas fa-history"></i>
                                <span class="nav-link-text">Lịch sử xóa câu trả lời</span>
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="@Url.Action("Logout","Account")" class="dropdown-item">
                                <i class="ni ni-user-run"></i>
                                <span>Đăng xuất</span>
                            </a>
                        </div>
                    </li>
                </ul>
                <script>
                    $(document).ready(function () {
                        $("#messageNotification").click(function () {
                            document.getElementById('messageCount').innerHTML = 0;
                            $.ajax({
                                type: "GET",
                                url: "/ShareView/StatusMessage"
                            })
                        })
                    })
                    $(document).ready(function () {
                        $("#notification").click(function () {
                            document.getElementById('notificationCount').innerHTML = 0;
                            $.ajax({
                                type: "GET",
                                url: "/ShareView/StatusNotification"
                            })
                        })
                    })
                </script>
            }
        </div>
    </div>
</nav>

